<template>
  <v-container class="id-cards pt-1">
    <v-row v-if="identities.length > 0">
      <v-col
        v-for="card in identities"
        :key="card.id"
        cols="12"
        class="py-0 px-2 mt-1 mb-2 card"
      >
        <v-container class="">
          <v-row>
            <v-col cols="2" class="pr-2"> <idcardImg /></v-col>
            <v-col cols="9" class="pl-2">
              <p class="sub-title-fields">
                {{ getIDTName(card.idt) }}
              </p>
              <v-container class="px-0">
                <v-row>
                  <v-col cols="3" class="px-1 pt-0" style="max-width:unset;">
                    <div
                      class="validity"
                      style="background-color: #d9fbed;"
                      v-if="isValid(card.expDate)"
                    >
                      <valid />
                      <p class="FIELD-TEXT">
                        {{ $t("cards.validity[1]") }}
                      </p>
                    </div>
                    <div
                      v-else
                      class="validity"
                      style="background-color: #fce7e7;"
                    >
                      <invalid />
                      <p class="FIELD-TEXT">
                        {{ $t("cards.validity[2]") }}
                      </p>
                    </div>
                  </v-col>
                  <v-col cols="8" class="pl-3 py-0 pr-0 mt-n3">
                    <p class="FIELD-TEXT">
                      {{ $t("cards.validity[0]") }}
                      {{ card.expDate }}
                    </p>
                  </v-col>
                </v-row>
              </v-container> </v-col
            ><v-col cols="1" class="pl-1">
              <v-btn text @click="moreInfo(card)" class="back-btn">
                <arrow-front />
              </v-btn> </v-col></v-row
        ></v-container>
      </v-col>
    </v-row>
    <v-row v-else>
      <v-col cols="12" class="px-15 py-9">
        <p class="SECUNDARY-LINKS mb-5">{{ $t("cards.noids") }}</p>
        <a
          class="links"
          target="_blank"
          color="#01a3b0"
          href="https://www.dev.wallid.io/import"
          @click.stop
        >
          {{ $t("cards.store") }}
        </a>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import ArrowFront from "../../images/icon-arrow-front.vue";
import IconAlert from "../../images/icon-warning-red.vue";
import idcardImg from "../../images/icon-id-document.vue";
import invalid from "../../images/invalid.vue";
import valid from "../../images/valid.vue";

import { ENCRYPT } from "../../store/actions";

import { mapGetters } from "vuex";

export default {
  components: {
    ArrowFront,
    IconAlert,
    idcardImg,
    valid,
    invalid,
  },
  computed: {
    ...mapGetters(["identities"]),
  },
  methods: {
    moreInfo(card) {
      console.log(card);

      // let dataID = {
      //   dataID: {
      //     storeIDProvider: {
      //       wa: "0x67E191D4bA926E49b139BD927ba34E5034ac550a",
      //       name: "storeid.caixamagica.pt",
      //       url: "https://storeid.caixamagica.pt/api/v1/data",
      //     },
      //     data: {
      //       wa: "0x11EF4f801A93Ae06A00b13086D0066137f1937bd",
      //       idt: "CC_PT",
      //       idtName: "Cartão de Cidadão - Portuguese Republic",
      //       identityID: {
      //         identityAttributes: {
      //           Surname: "PEDRO ARSÉNIO",
      //           Givenname: "O Burro",
      //           Sex: "M",
      //           Height: "1,76",
      //           Country: "PRT",
      //           Birthdate: "06 09 1994",
      //           GivenNameFather: "ANTÓNIO MANUEL",
      //           SurnameFather: "SERRÃO ARSÉNIO",
      //           GivenNameMother: "MARIA TERESA",
      //           SurnameMother: "FERREIRA PEDRO ARSÉNIO",
      //           Documenttype: "Cartão de Cidadão",
      //           Documentnum: "14609547 2 ZX6",
      //           CivilianIdNumber: "146095472",
      //           Documentversion: "006.008.24",
      //           DocumentPAN: "0000044967158658",
      //           Nationality: "PRT",
      //           Validityenddate: "16 09 2029",
      //           Validitybegindate: "16 09 2019",
      //           PlaceOfRequest: "SCV Sistema Externo",
      //           IssuingEntity: "República Portuguesa",
      //           NISS: "12038129067",
      //           NSNS: "388906470",
      //           NIF: "252134460",
      //           Validation: "O Cartão de Cidadão encontra-se activo",
      //           MRZ1: "I<PRT146095472<ZX68<<<<<<<<<<<",
      //           MRZ2: "9409064M2909163PRT<<<<<<<<<<<6",
      //           MRZ3: "PEDRO<ARSENIO<<GUILHERME<<<<<<",
      //           AccidentalIndications: "",
      //         },
      //         addressAttributes: {
      //           CountryCode: "PT",
      //           District: "SANTARÉM",
      //           DistrictCode: "14",
      //           Municipality: "RIO MAIOR",
      //           MunicipalityCode: "1414",
      //           Parish: "SÃO JOÃO DA RIBEIRA E RIBEIRA DE SÃO JOÃO",
      //           ParishCode: "141418",
      //           Streettype: "RUA",
      //           AbbrStreetType: "R",
      //           Streetname: "1º DE DEZEMBRO",
      //           Buildingtype: "",
      //           AbbrBuildingType: "",
      //           Doorno: "nº 4",
      //           Floor: "",
      //           Place: "",
      //           Side: "",
      //           Locality: "CABEÇA GORDA",
      //           Zip4: "2040",
      //           Zip3: "452",
      //           PostalLocality: "SÃO JOÃO DA RIBEIRA",
      //           GeneratedAddressCode: "201401",
      //         },
      //       },
      //       verifyID: {
      //         walletSignature:
      //           "34d8a40bf5e44e21564989ac16015107096ca350ce38be037fd47591818b31791ffd815ada36e9ab4afee916b05ba9511a681f0f07dfe936497ac5224abbc5dc8bb60e790c12a6400fd09da3ab38193f99bd26337bfc371fe68100c5cbfda8a40470c8eb1200f287cc9b6429584a97613fe23ee69df0730dec8fb91d07f3921a146d98d7e85deb15906304829876c891deaf3bb15140b2ce73787d7123d16232ead7558b50ab9721b4928bc72d334c628618974a92db465ea8a7aedc2000c44d449d3721cf92db0c3801af8e76d4b10a32a88285407099edc3f0ac6ded0377221b2e0ba616aa2e8ec754fabc5837eec7588eb10d796c1395945c4958c4862d4ec826b72912375e08877584e9cc97e10c25c63f9cc0484363d17e04ce5b0ed91a8ad0cea5f4625b75cd5e8281b982853595eef1a80e1172c7186db37d16348a8cfe46c759651738b78d4fef012b258eb4946b98a5d5540fca563324b6981ba511f6bbdcfdf612c6d18303228e17106655b6bc81b0e988deee7b7373bf3c09550f",
      //         sod:
      //           "77820bbe30820bba06092a864886f70d010702a0820bab30820ba7020103310f300d060960864801650304020105003081c20606678108010101a081b70481b43081b1020100300d0609608648016503040201050030819c30250201010420e416a128c1eb0e723a6fcf862be2e32cd7d840d8f4aa3e9d5305a94f6790fc6d3025020102042062fb6315bd0eefae8201dbc2dbde21628a848ed6336715943a324b36d6788b65302502010304207ec45158990c0f6e13dee4fa23b2400e53e53d736927f950fd32e2c696702215302502010404204dfce370b65a6296f830422f357c48214e22aefbbd6c33db7db8237de6dd96e8a08207bf308207bb308205a3a003020102020845b30614aaec8e73300d06092a864886f70d01010b0500308184310b30090603550406130250543140303e060355040a0c3753434545202d2053697374656d6120646520436572746966696361c3a7c3a36f20456c65637472c3b36e69636120646f2045737461646f3111300f060355040b0c08454345737461646f3120301e06035504030c1743617274c3a36f206465204369646164c3a36f20303035301e170d3139303930323136353931355a170d3239313030323136353931355a3081d2310b3009060355040613025054311c301a060355040a0c1343617274c3a36f206465204369646164c3a36f31293027060355040b0c205365727669c3a76f7320646f2043617274c3a36f206465204369646164c3a36f312d302b060355040b0c24456e74696461646520436572746966696361646f726120646520446f63756d656e746f73314b304906035504030c42456e74696461646520436572746966696361646f726120646520446f63756d656e746f7320646f2043617274c3a36f206465204369646164c3a36f2030303031373230820222300d06092a864886f70d01010105000382020f003082020a0282020100c52dd0c06101fe7012e0b3b1cfa86dc992a10c43e3341597e92b82f9d62ae7844eb5fc3c9d4de2ed5b100d411c187bce27c09423662042f5e7ca4ade626fa886d761ab97d517775b7db6945611e9eb8f489f0d9048aff05c374ed0c0dd0e2de0f68f1c1518cd51fd6bcbd3a264b3bb51688f75d20a1252ca6df4565d871f5852b6ebc51f0dccd33695f83062e1b1b937adc568fab90cbf286fa30ac37467a00b2f54a077da1c8ba4a891269f5f7553f7954444b422e75c945f6048b4600d20ce7a2192a507eeca3687fd14afa1f219e296d74172c3653e2c961a24f42606100175124601cf5427b70530e91469287e8bc205bde78a5bc244662d924fcf8f624dc5b0047b2557234df31041177fbc943a2119d25e6c937a4784390b741a284afa8dc2f6a5e3294d2ee4d7e9d5dd238860b8306199470c6c7abed25d1d57404994c7d5192bf5426ce3d355844b547aaa3e9d893e0951c9d34c229476dc98b0ad2558c2d45e8bece624124b397b3fe9701d6163abd407b14fa3a701d8c564c533289c8383085f5140772e258e9875f271a2464e26ba23b04d07f41f111f800182b17ae8be9f68e36e76c872af778de3690914793b02e8f7b3ffba5d9412fd1efb3cd6e12c4ea7d12c0f6c2f02df549f44703759ec4af6460f1844836ceb7c39d532b46249212b072eb04ec74e078ef24a2b4bf94d166a14950bdac5400a59a519950203010001a38201df308201db304c06082b060105050701010440303e303c06082b060105050730018630687474703a2f2f6f6373702e726f6f742e63617274616f64656369646164616f2e70742f7075626c69636f2f6f637370301d0603551d0e04160414c195acb9b4e7d1961aed8d2ee06ac1809cf15b68300c0603551d130101ff04023000301f0603551d23041830168014f6cb83b28f03605a8c645c7d91d14eb53966e1293081d30603551d200481cb3081c83066060a60846c010101020400073058305606082b06010505070201164a687474703a2f2f706b692e63617274616f64656369646164616f2e70742f7075626c69636f2f706f6c6974696361732f6470632f63635f65635f6369646164616f5f6470632e68746d6c305e060b60846c0101010204000105304f304d06082b060105050702011641687474703a2f2f706b692e63617274616f64656369646164616f2e70742f7075626c69636f2f706f6c6974696361732f70632f63635f4543445f70632e68746d6c30570603551d1f0450304e304ca04aa0488646687474703a2f2f706b692e63617274616f64656369646164616f2e70742f7075626c69636f2f6c72632f63635f65635f6369646164616f5f63726c3030355f63726c2e63726c300e0603551d0f0101ff040403020780300d06092a864886f70d01010b0500038202010093f26fb36508433404a621815ea0c5db948a2b19492e8af19a011c8f3430615068e48a0ec77013c2b0649581533c3e0e96465eb521e09dca3acc10a41703b51355abcb0309b1a07e19f9fcd717c288765410662d587129d64974c84dbebebd4fb71828d95415aba45ace199c834183b830bb874a13939d7f6c322cabad87eb6911192b43e41e6223c9d49467572bb04260ccc2bc9b23ebb9d010850489bd4dbcf99d1eaacfa9584f8ddfbf02efdc7b89ee191c68a7f0959b10e71532f5ea82cc5413078a14044b947c8f36277cce2f408feac361e150992a01c5d82fd4755719f4e8b874b7d0ea56ca8172c1c9aa77f049f4cadccd781bc39a36c519ce61d1dc72d6cf24bf12f95497b80207f69afd624054ae09296b4f93dd0c7cf72acd72d4408ba004baf2faed6734758f97e057edf0a0ae32f28b2c0fba1ec69ee7c19d1cccb0e8152b4d994126c22acd225dc5976586fa996dd20e044574933193f86a1ad9756061b3869c64695fc7f1a0dafcfa70ce7bab98ebd52b1ac26a80f7e37a970dce574616f01a6a83ca1a68830b3fc390746cdcd20e3d69641b55ab792a1ac68d11fb2b617d4bcf1b85571a5e10b912c218c18b54231afccfb2110cee6896519d231409103e6eae987ea89e82b3bdd8888bee6d277f7a0bd0ad51def0a82a83a12c2cc345c6f0eb2fc86d5d7102c281456f85bde6a9ef3055dac38b52daafae3182030730820303020101308191308184310b30090603550406130250543140303e060355040a0c3753434545202d2053697374656d6120646520436572746966696361c3a7c3a36f20456c65637472c3b36e69636120646f2045737461646f3111300f060355040b0c08454345737461646f3120301e06035504030c1743617274c3a36f206465204369646164c3a36f20303035020845b30614aaec8e73300d06096086480165030402010500a048301506092a864886f70d01090331080606678108010101302f06092a864886f70d0109043122042031be27ebb2cdea06c6b6e9ac84918693c800e2c48fa357776b6dc48415464618300d06092a864886f70d01010b0500048202000c870ac84092d0d828762487cef5b2292af97eb6a2cdca42971bdbbef11dcc41c19f037697d03f6b333e7ef6be354e0f9f2d71714ee7eff0aa287fa32e97d1e5af814791874f0ffeb94e61a710f46d22136a5281866338a1d150db68d7cb620afd2e05f9ec12dddbc323c50badfd12e239bef9499f00cd1dc9f1543c406fbb35ea43e376250978e7129a140943d95a0fecdce618ba6590ba73411c5a106ed2676985810200b84966570074a6ac94fdc755a3c262218b7f3fa8a89cd085a734830b66f82b3c692d43cef1fac6549b43958dfb0930e8cab6218b644ad60acb3db40d81a4c736eec594ef77e7e2a34e4f7af592dedb1e7faa49c5c8b7ba57ecb9818ce96e2baa0ab3b6325c1774d0696379b45ded87e722bc910f6c016733fa2effc79a4e9a2039f76b634eed5372a9688b931792502c1f8691eb16921376cd85eb52a637904b59699543959706231c19b64357d379b7d785a1c74574879cc59178e66638057e30506c9de49ef5b2efd68ff4552c96a58fd4dff7b6d49fc988ce2bd064545ccb42a9e13bf679ff84edb480c6674e35240d6777ee1d02b83a0f58e6e747f6e087b8132a8248ffe4fff023f1ea33d929ba9e07f876726b8a4eac64d110c38da86c0bd00be825ea0a01c7fad9a1d5f474c389aca3aa564f699b0386fda4bf871d2979fb88211e5c49d7494dfb68c25104fa41caddace5680f9948e59b",
      //         certificate:
      //           "3082091a30820702a0030201020208026ecd6d7553592b300d06092a864886f70d01010b05003081b1310b300906035504061302505431333031060355040a0c2a496e7374697475746f20646f73205265676973746f73206520646f204e6f7461726961646f20492e502e311c301a060355040b0c1343617274c3a36f206465204369646164c3a36f31143012060355040b0c0b737562454345737461646f3139303706035504030c30454320646520417574656e74696361c3a7c3a36f20646f2043617274c3a36f206465204369646164c3a36f2030303136301e170d3139303931363136333233375a170d3239303931353136333233375a3081d4310b3009060355040613025054311c301a060355040a0c1343617274c3a36f206465204369646164c3a36f31233021060355040b0c1a417574656e74696361c3a7c3a36f20646f204369646164c3a36f311c301a060355040b0c134369646164c3a36f20506f7274756775c3aa733117301506035504040c0e504544524f20415253c3894e494f31123010060355042a0c094755494c4845524d45311430120603550405130b42493134363039353437323121301f06035504030c184755494c4845524d4520504544524f20415253c3894e494f308201a2300d06092a864886f70d01010105000382018f003082018a0282018100b0da320ea85f8c2187bfe4ded5e2473bd15c2a6a471985cb0a5c3fa66ea14bbea1d1adffa4e28beb049fc087fba57b94f65f5a346aadfe82674150036bcaae87c575819005971f883134c0c9f68a9ad4479a0f998d3d4a6b45808744764a6aec15020c8509ba8cf5bae296e53ec486dcbd0dae815d64e173fed2dafa57c3de20ca79a8fc7c281f8bae38774e7c71b71f666019bb4d0c362af51223e6bd06ed802fe4cfdc5c571ac5e33a68a5d4314ed309ad362fe115a391c30845f2e69ebcc94b5f100ccf556210a623818a0a2cc283c8c8005557e7a60c664fccfa92f661c32b39f5382195b5ba8bffcfc7bbe78fca2aeaaf22f95055563baae4e922b9a8611d4030eb082d05149dc41f40f501366ee62cd1839df47ab43e92048fc972a5ce1712956bdf4e8bef86a4ac80897c8d037945182a514c4e50c403df1ac139d949234d3d17489980ecc8b8a4cd7bb895a342d0d43a75e729479dbf7454b7d9322044d7bfcfc6f6396cdd27e03d6e024fe786c451011982969137eeea75ed2e79510203010001a382038f3082038b300c0603551d130101ff04023000301f0603551d2304183016801453e9852c7644cbf2d5d1edbe16138008fa8f3a8c304b06082b06010505070101043f303d303b06082b06010505073001862f687474703a2f2f6f6373702e6175632e63617274616f64656369646164616f2e70742f7075626c69636f2f6f63737030710603551d2e046a30683066a064a0628660687474703a2f2f706b692e63617274616f64656369646164616f2e70742f7075626c69636f2f6c72632f63635f7375622d65635f6369646164616f5f617574656e7469636163616f5f63726c303031365f64656c74615f70303030312e63726c308201bd0603551d20048201b4308201b03035060860846c010101020a3029302706082b06010505070201161b68747470733a2f2f7777772e736365652e676f762e70742f7265703081c8060860846c01010102143081bb3081b806082b060105050702023081ab1e81a8004f00200063006500720074006900660069006300610064006f00200065006d0069007400690064006f00200073006500670075006e0064006f0020006500730074006100200070006f006c00ed0074006900630061002000e90020007500740069006c0069007a00610064006f0020007000610072006100200061007500740065006e007400690063006100e700e3006f00200064006f00200043006900640061006400e3006f3055060c60846c0101010204020001013045304306082b060105050702011637687474703a2f2f706b692e63617274616f64656369646164616f2e70742f7075626c69636f2f706f6c6974696361732f63702e68746d6c3055060b60846c01010102040200073046304406082b060105050702011638687474703a2f2f706b692e63617274616f64656369646164616f2e70742f7075626c69636f2f706f6c6974696361732f6370732e68746d6c30280603551d090421301f301d06082b060105050709013111180f31393934303930363132303030305a30130603551d25040c300a06082b06010505070302306b0603551d1f046430623060a05ea05c865a687474703a2f2f706b692e63617274616f64656369646164616f2e70742f7075626c69636f2f6c72632f63635f7375622d65635f6369646164616f5f617574656e7469636163616f5f63726c303031365f70303030312e63726c301d0603551d0e04160414e9c2339c7c39aa58e2bc429ee907a4f27e06f2d5300e0603551d0f0101ff040403020388300d06092a864886f70d01010b05000382020100c95dd12341d1e0fb8fa43532640516a6564cf63dd2ffe73394e45d1144b81bf738cd5c2670df6b837b9ba681d49bb5e7c6b4811d56e3714a53d07f0ced80c776d55fe5dfccee14bd75da70f842efedca54af07fa60e8c2bf628f656a7bc423866e2497edd016cae3fdac630044d1f4f8a4d18890c0d181731b134fcbeb5adf72038a93b63051aa3ae68188d5f124c919f9a38164bbe751908e7ae63c11b18206941eaef124516fb4803fce4507af447d4abe2bbbe42aa76f522075d656040b71f45a2200dea04e22c4102ad475c39d5f3cbe3d50bae581c51db9be2df468b5a7af6b4ece202e320246169bc4a6b43b1378d4bb73c14f085d0956e6d62694fa22b287bf5150f72085407f6f480d69280164726efd6313e2a48a0de8b39b0513e588c41336a4ed5e5db7821f915e69c2df22588d5b835378925f2a7199044ef849b93e2704e9bb36c3833d08597ce9c638810569337d547202977b7879737658e6f3a518c07aaee4f56d46fa4051545cd030abd4d9a0b9ba87d321f03546fc81bcce063ec169a6707151e731a051c1d49dfcd7867d1bf6035ad1cd6a1694a2deaeb64544280c29494adf660667f528c03424036f9134e7ca84e44639b44e1852c14eb8ec51fc9c630c1d3074d3a97b7395eb0261272f4b3aebb91aa965d598feae7c72d400072799944ebe0c650fc7c18b56537ae3b31ab2e49cb6333ba97ef4d3",
      //       },
      //     },
      //   },
      // };

      this.$router.push({ name: "Card", params: { card } });

      // this.$store
      //   .dispatch(ENCRYPT, { data: dataID })
      //   .then((res) => {
      //     console.log(res);
      //     card.data = res;
      //     this.$router.push({ name: "Card", params: { card } });
      //   })
      //   .catch((e) => {
      //     this.logError(e);
      //   });
    },
    isValid(_expDate) {
      if (_expDate) {
        var parts = _expDate.split(" ");
        var expDate = new Date(parts[2], parts[1] - 1, parts[0]);
        let currDate = new Date();
        var millisecondsPerDay = 1000 * 60 * 60 * 24;
        var millisBetween = currDate.getTime() - expDate.getTime();
        var days = millisBetween / millisecondsPerDay;
        console.log(Math.floor(days));
        // Round down.
        return Math.floor(days) <= 0;
      } else {
        return false;
      }
    },
  },
  data() {
    return {};
  },
};
</script>

<style lang="scss" scoped>
.id-cards {
  overflow-y: auto;
  overflow-x: hidden;

  height: 200px;
  .card {
    height: 82px;
    background-color: var(--white);
    .sub-title-fields {
      font-size: 14px !important;
      text-align: left;
    }
    .col-8 {
      align-items: center;
      display: flex;
    }
    .FIELD-TEXT {
      text-align: left;
    }
    .back-btn {
      padding: 0 !important;
      min-width: 16px !important;
    }
    .validity {
      border-radius: 11px;
      background-color: #d8d8d8;
      width: fit-content;
      padding: 1px;
      padding-right: 8px;
      display: flex;
      svg {
        margin: 6px;
      }
    }
  }
}
</style>
